# Migration `20210310052006-migration`

This migration has been generated by patrick at 3/10/2021, 12:20:06 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "AuthDetail" (
    "id" TEXT NOT NULL,
    "nonce" TEXT NOT NULL,
    "timestamp" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
    "id" TEXT NOT NULL,
    "address" TEXT NOT NULL,
    "platformId" TEXT NOT NULL,
    "platform" TEXT NOT NULL,
    "authDetailId" TEXT,

    FOREIGN KEY ("authDetailId") REFERENCES "AuthDetail"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Guild" (
    "platformId" TEXT NOT NULL,
    "platform" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "iconUrl" TEXT,
    "description" TEXT,
    PRIMARY KEY ("platformId")
)

CREATE TABLE "Role" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "platformId" TEXT NOT NULL,
    "description" TEXT,
    "balance" TEXT NOT NULL,
    "guildPlatformId" TEXT NOT NULL,
    "tokenId" TEXT NOT NULL,

    FOREIGN KEY ("guildPlatformId") REFERENCES "Guild"("platformId") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("tokenId") REFERENCES "Token"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Token" (
    "id" TEXT NOT NULL,
    "chainId" INTEGER NOT NULL,
    "contractAddress" TEXT NOT NULL,
    "type" TEXT NOT NULL,
    "tokenId" INTEGER,
    "uri" TEXT,
    "website" TEXT,
    "iconUrl" TEXT,
    "purchaseUrl" TEXT,
    PRIMARY KEY ("id")
)

CREATE TABLE "_userGuilds" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Guild"("platformId") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "_userRoles" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Role"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.address_unique" ON "User"("address")

CREATE UNIQUE INDEX "User.platformId_unique" ON "User"("platformId")

CREATE UNIQUE INDEX "_userGuilds_AB_unique" ON "_userGuilds"("A", "B")

CREATE INDEX "_userGuilds_B_index" ON "_userGuilds"("B")

CREATE UNIQUE INDEX "_userRoles_AB_unique" ON "_userRoles"("A", "B")

CREATE INDEX "_userRoles_B_index" ON "_userRoles"("B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20210310052006-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,58 @@
+datasource DS {
+  provider =  ["postgresql","sqlite"]
+  url = "***"
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = "native"
+}
+
+model AuthDetail {
+  id        String   @id @default(uuid())
+  nonce     String
+  timestamp DateTime @default(now())
+}
+
+model User {
+  id         String     @id @default(uuid())
+  address    String     @unique
+  platformId String @unique
+  platform String
+  authDetail AuthDetail?
+  guilds Guild[] @relation(name: "userGuilds")
+  roles Role[] @relation(name: "userRoles")
+}
+
+model Guild {
+  platformId String @id
+  platform String
+  name String
+  iconUrl String?
+  description String?
+  roles Role[] @relation(name: "guildRoles")
+  users User[] @relation(name: "userGuilds")
+}
+
+model Role {
+  id String @id @default(uuid())
+  guild Guild @relation(name: "guildRoles")
+  name String
+  platformId String
+  description String?
+  token Token
+  balance String
+  users User[] @relation(name: "userRoles")
+}
+
+model Token {
+  id        String   @id @default(uuid())
+  chainId Int
+  contractAddress String
+  type String // erc721 or erc20
+  tokenId Int? // only for erc721
+  uri String? // only for erc721
+  website String?
+  iconUrl String?
+  purchaseUrl String?
+}
```


